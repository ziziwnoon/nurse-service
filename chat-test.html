<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>ØªØ³Øª Ú†Øª Ø³ÙˆÚ©Øª</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body>
  <h2>ØªØ³Øª Ú†Øª Ø³Ø§Ø¯Ù‡ Ø¨Ø§ WebSocket</h2>

  <label>ØªÙˆÚ©Ù† JWT: <input type="text" id="tokenInput" size="80"
    value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2ODFlMzBlNTg1NWFkNzQ3NzRhYmVhY2EiLCJyb2xlIjoicGF0aWVudCIsImlhdCI6MTc0Njg3NDkwNCwiZXhwIjoxNzQ2ODc4NTA0fQ._PgoV2YE3VijpjzRfb93zLPnyRvWHOuTYjv2knWo3d0"></label><br>
  <label>Ú¯ÛŒØ±Ù†Ø¯Ù‡: <input type="text" id="receiverId" value="456"></label><br>
  <label>Ù…ØªÙ† Ù¾ÛŒØ§Ù…: <input type="text" id="messageContent" value="Ø³Ù„Ø§Ù… Ù¾Ø±Ø³ØªØ§Ø±!"></label><br>

  <button onclick="connect()">Ø§ØªØµØ§Ù„</button>
  <button onclick="sendMessage()">Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…</button>

  <hr>
  <div id="messages"></div>

  <script>
    let socket;

    function connect() {
      const token = document.getElementById('tokenInput').value;

      socket = io('http://localhost:5000', {
        auth: { token },
      });

      socket.on("connect", () => {
        console.log("ÙˆØµÙ„ Ø´Ø¯:", socket.id);
        appendMessage("âœ… Ø§ØªØµØ§Ù„ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯");
      });

      socket.on("receive_message", (data) => {
        console.log("Ù¾ÛŒØ§Ù… Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯:", data);
        appendMessage(`ğŸ“© Ù¾ÛŒØ§Ù… Ø§Ø² ${data.senderId}: ${data.content}`);
      });

      socket.on("disconnect", () => {
        appendMessage("âŒ Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„");
      });
    }

    function sendMessage() {
      const receiverId = document.getElementById('receiverId').value;
      const content = document.getElementById('messageContent').value;

      if (!socket || !socket.connected) {
        appendMessage("â›” Ø§Ø¨ØªØ¯Ø§ Ø§ØªØµØ§Ù„ Ø±Ø§ Ø¨Ø±Ù‚Ø±Ø§Ø± Ú©Ù†ÛŒØ¯.");
        return;
      }

      socket.emit("send_message", { receiverId, content });
      appendMessage(`âœ… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ Ø¨Ù‡ ${receiverId}: ${content}`);
    }

    function appendMessage(text) {
      const div = document.createElement('div');
      div.textContent = text;
      document.getElementById('messages').appendChild(div);
    }
  </script>
</body>
</html>
